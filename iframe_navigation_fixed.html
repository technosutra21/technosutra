<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navegador Cap√≠tulos - Vers√£o Aprimorada</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            overflow: hidden;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: transparent;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80px;
            padding: 4px;
        }
        
        .nav-container {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
        }
        
        .nav-button {
            background: linear-gradient(135deg, #cc0000, #aa0000);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 50px;
            box-shadow: 0 2px 8px rgba(204, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .nav-button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }
        
        .nav-button:hover:before {
            left: 100%;
        }
        
        .nav-button:hover {
            background: linear-gradient(135deg, #910335, #700025);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(204, 0, 0, 0.4);
        }
        
        .nav-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(204, 0, 0, 0.3);
        }
        
        .nav-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.6;
        }
        
        .nav-button:disabled:hover {
            background: #ccc;
            transform: none;
        }
        
        .chapter-indicator {
            font-size: 14px;
            font-weight: 500;
            color: #666;
            background: rgba(255,255,255,0.1);
            padding: 4px 8px;
            border-radius: 4px;
            min-width: 80px;
            text-align: center;
        }
        
        /* Anima√ß√£o de carregamento */
        .loading {
            opacity: 0.5;
            pointer-events: none;
        }
        
        /* Responsividade */
        @media (max-width: 480px) {
            .nav-container {
                gap: 12px;
            }
            
            .nav-button {
                padding: 6px 12px;
                font-size: 14px;
                min-width: 40px;
            }
            
            .chapter-indicator {
                font-size: 12px;
                padding: 3px 6px;
                min-width: 70px;
            }
        }
    </style>
</head>
<body>
    <div class="nav-container">
        <button class="nav-button" id="prevBtn" title="Cap√≠tulo anterior">
            ‚Üê Before
        </button>
        
        <div class="chapter-indicator" id="chapterIndicator">
            Cap. 1
        </div>
        
        <button class="nav-button" id="nextBtn" title="Pr√≥ximo cap√≠tulo">
            Next ‚Üí
        </button>
    </div>

    <script>
        // === CONFIGURA√á√ÉO ===
        let currentChapter = 1;
        const MAX_CHAPTERS = 56;
        const MIN_CHAPTERS = 1;
        
        // === ELEMENTOS DOM ===
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const chapterIndicator = document.getElementById('chapterIndicator');
        const navContainer = document.querySelector('.nav-container');
        
        // === CONTROLE DE ESTADO ===
        let isUpdating = false;
        let updateTimeout;
        
        // === FUN√á√ÉO PRINCIPAL DE ATUALIZA√á√ÉO ===
        function updateChapter() {
            // Evitar m√∫ltiplas atualiza√ß√µes simult√¢neas
            if (isUpdating) {
                // Dev: console.log('‚è≠Ô∏è Atualiza√ß√£o j√° em andamento, ignorando...');
                return;
            }
            
            isUpdating = true;
            
            try {
                // Atualizar estado dos bot√µes
                updateButtonStates();
                
                // Atualizar indicador visual
                updateChapterIndicator();
                
                // Enviar mensagem para o Wix Velo
                sendChapterUpdate();
                
                // Dev: console.log(`‚úÖ Navega√ß√£o atualizada para cap√≠tulo ${currentChapter}`);
                
            } catch (error) {
                // Dev: console.error('‚ùå Erro na atualiza√ß√£o:', error);
            } finally {
                // Liberar flag ap√≥s delay
                setTimeout(() => {
                    isUpdating = false;
                }, 200);
            }
        }
        
        // === FUN√á√ïES AUXILIARES ===
        function updateButtonStates() {
            prevBtn.disabled = currentChapter <= MIN_CHAPTERS;
            nextBtn.disabled = currentChapter >= MAX_CHAPTERS;
            
            // Feedback visual
            if (prevBtn.disabled) {
                prevBtn.setAttribute('title', 'Primeiro cap√≠tulo');
            } else {
                prevBtn.setAttribute('title', `Ir para cap√≠tulo ${currentChapter - 1}`);
            }
            
            if (nextBtn.disabled) {
                nextBtn.setAttribute('title', '√öltimo cap√≠tulo');
            } else {
                nextBtn.setAttribute('title', `Ir para cap√≠tulo ${currentChapter + 1}`);
            }
        }
        
        function updateChapterIndicator() {
            if (chapterIndicator) {
                chapterIndicator.textContent = `Cap. ${currentChapter}`;
            }
        }
        
        function sendChapterUpdate() {
            if (!window.parent) {
                // Dev: console.warn('‚ö†Ô∏è window.parent n√£o dispon√≠vel');
                return;
            }
            
            const message = {
                type: 'chapterUpdate',
                chapterId: currentChapter,
                timestamp: Date.now(),
                source: 'navigation-iframe'
            };
            
            try {
                window.parent.postMessage(message, '*');
                // Dev: console.log(`üì§ Mensagem enviada para Wix:`, message);
            } catch (error) {
                // Dev: console.error('‚ùå Erro ao enviar mensagem:', error);
            }
        }
        
        // === FUN√á√ÉO DEBOUNCED ===
        function debouncedUpdate() {
            clearTimeout(updateTimeout);
            updateTimeout = setTimeout(updateChapter, 100);
        }
        
        // === EVENT LISTENERS ===
        prevBtn.addEventListener('click', function(e) {
            e.preventDefault();
            
            if (currentChapter > MIN_CHAPTERS && !isUpdating) {
                currentChapter--;
                // Dev: console.log(`‚¨ÖÔ∏è Navegando para cap√≠tulo ${currentChapter}`);
                
                // Feedback visual imediato
                navContainer.classList.add('loading');
                setTimeout(() => navContainer.classList.remove('loading'), 300);
                
                debouncedUpdate();
            }
        });
        
        nextBtn.addEventListener('click', function(e) {
            e.preventDefault();
            
            if (currentChapter < MAX_CHAPTERS && !isUpdating) {
                currentChapter++;
                // Dev: console.log(`‚û°Ô∏è Navegando para cap√≠tulo ${currentChapter}`);
                
                // Feedback visual imediato
                navContainer.classList.add('loading');
                setTimeout(() => navContainer.classList.remove('loading'), 300);
                
                debouncedUpdate();
            }
        });
        
        // === NAVEGA√á√ÉO POR TECLADO ===
        document.addEventListener('keydown', function(e) {
            if (isUpdating) return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    if (!prevBtn.disabled) prevBtn.click();
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    if (!nextBtn.disabled) nextBtn.click();
                    break;
                case 'Home':
                    e.preventDefault();
                    if (currentChapter !== MIN_CHAPTERS) {
                        currentChapter = MIN_CHAPTERS;
                        debouncedUpdate();
                    }
                    break;
                case 'End':
                    e.preventDefault();
                    if (currentChapter !== MAX_CHAPTERS) {
                        currentChapter = MAX_CHAPTERS;
                        debouncedUpdate();
                    }
                    break;
            }
        });
        
        // === LISTENER PARA MENSAGENS EXTERNAS ===
        window.addEventListener('message', function(event) {
            // Dev: console.log('üì® Mensagem externa recebida:', event.data);
            
            if (event.data && event.data.type === 'navigateToChapter') {
                const targetChapter = event.data.chapterId;
                
                if (typeof targetChapter === 'number' && 
                    targetChapter >= MIN_CHAPTERS && 
                    targetChapter <= MAX_CHAPTERS) {
                    
                    currentChapter = targetChapter;
                    debouncedUpdate();
                    // Dev: console.log(`üéØ Navega√ß√£o externa para cap√≠tulo ${targetChapter}`);
                }
            }
        });
        
        // === INICIALIZA√á√ÉO ===
        function initialize() {
            // Dev: console.log('üöÄ Inicializando navegador de cap√≠tulos...');
            
            // Configura√ß√£o inicial
            currentChapter = 1;
            
            // Primeira atualiza√ß√£o
            updateChapter();
            
            // Notificar que o iframe est√° pronto
            setTimeout(() => {
                if (window.parent) {
                    window.parent.postMessage({
                        type: 'navigationReady',
                        timestamp: Date.now(),
                        maxChapters: MAX_CHAPTERS
                    }, '*');
                }
            }, 500);
            
            // Dev: console.log('‚úÖ Navegador inicializado com sucesso');
        }
        
        // === INICIALIZA√á√ÉO ROBUSTA ===
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }
        
        // === LOG DE DEBUG ===
        // Dev: console.log('üéØ Navegador de cap√≠tulos carregado');
        // Dev: console.log(`üìä Configura√ß√£o: Cap√≠tulos ${MIN_CHAPTERS}-${MAX_CHAPTERS}`);
    </script>
</body>
</html>
