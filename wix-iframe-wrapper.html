<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wix Site Wrapper</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: transparent;
        }
        
        .iframe-container {
            width: 100%;
            height: 100%;
            position: relative;
            background: transparent;
        }
        
        .wix-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            /* Isolar completamente o contexto React */
            isolation: isolate;
            /* Evitar interferências de CSS */
            all: initial;
            display: block;
        }
        
        /* Loading overlay */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.3s ease;
        }
        
        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-text {
            font-family: Arial, sans-serif;
            font-size: 16px;
            color: #666;
        }
        
        /* Error fallback */
        .error-message {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-family: Arial, sans-serif;
            color: #666;
        }
        
        .error-message.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="iframe-container">
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-text">Carregando...</div>
        </div>
        
        <iframe 
            id="wixFrame"
            class="wix-iframe"
            src=""
            allow="accelerometer; camera; encrypted-media; geolocation; gyroscope; microphone; midi; payment; usb; xr-spatial-tracking"
            sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-top-navigation-by-user-activation"
            loading="lazy"
            importance="high">
        </iframe>
        
        <div class="error-message" id="errorMessage">
            <h3>Erro ao carregar o conteúdo</h3>
            <p>Por favor, recarregue a página</p>
        </div>
    </div>

    <script>
        // Configuração do iframe
        const SITE_URL = 'SUA_URL_DO_SITE_WIX_AQUI'; // Substitua pela URL do seu site Wix
        const iframe = document.getElementById('wixFrame');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const errorMessage = document.getElementById('errorMessage');
        
        let loadTimeout;
        let isLoaded = false;
        
        // Função para inicializar o iframe
        function initializeIframe() {
            // Dev: console.log('Inicializando iframe isolado...');
            
            // Configurar atributos do iframe para máximo isolamento
            iframe.setAttribute('referrerpolicy', 'no-referrer');
            iframe.setAttribute('credentialless', 'true');
            
            // Definir URL após um pequeno delay
            setTimeout(() => {
                iframe.src = SITE_URL;
            }, 100);
            
            // Timeout para detectar falha de carregamento
            loadTimeout = setTimeout(() => {
                if (!isLoaded) {
                    showError();
                }
            }, 15000); // 15 segundos
        }
        
        // Event listeners para o iframe
        iframe.addEventListener('load', function() {
            // Dev: console.log('Iframe carregado com sucesso');
            isLoaded = true;
            clearTimeout(loadTimeout);
            hideLoading();
            
            // Tentar estabelecer comunicação com o site Wix
            try {
                // Enviar mensagem de inicialização
                iframe.contentWindow.postMessage({
                    type: 'wrapperReady',
                    timestamp: Date.now()
                }, '*');
            } catch (error) {
                // Dev: console.log('Comunicação cross-origin limitada (normal)');
            }
        });
        
        iframe.addEventListener('error', function() {
            // Dev: console.error('Erro ao carregar iframe');
            showError();
        });
        
        // Listener para mensagens do site Wix
        window.addEventListener('message', function(event) {
            // Verificar origem por segurança (opcional)
            // if (event.origin !== 'https://seu-dominio.wixsite.com') return;
            
            // Dev: console.log('Mensagem recebida do site Wix:', event.data);
            
            // Repassar mensagens para o parent se necessário
            if (window.parent && window.parent !== window) {
                try {
                    window.parent.postMessage(event.data, '*');
                } catch (error) {
                    // Dev: console.log('Não foi possível repassar mensagem para parent');
                }
            }
        });
        
        // Funções utilitárias
        function hideLoading() {
            loadingOverlay.classList.add('hidden');
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
            }, 300);
        }
        
        function showError() {
            clearTimeout(loadTimeout);
            loadingOverlay.style.display = 'none';
            errorMessage.classList.add('show');
        }
        
        // Listener para redimensionamento
        window.addEventListener('resize', function() {
            // Força recálculo do layout do iframe
            iframe.style.height = '99.9%';
            setTimeout(() => {
                iframe.style.height = '100%';
            }, 10);
        });
        
        // Inicializar quando o DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeIframe);
        } else {
            initializeIframe();
        }
        
        // Dev: console.log('Wrapper do iframe inicializado');
    </script>
</body>
</html>
