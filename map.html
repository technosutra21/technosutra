<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Mapa Interativo Techno Sutra AR - Navegue pelo Dharma Virtual</title>
    <meta name="description" content="Explore o mapa interativo dos 56 cap√≠tulos do Avatamsaka Sutra. Navegue pelo dharma virtual com visualiza√ß√µes em realidade aumentada e descubra os ensinamentos budistas de forma imersiva.">
    <meta name="keywords" content="Avatamsaka Sutra, Mapa Interativo, Dharma Virtual, Budismo, Realidade Aumentada, AR, Navega√ß√£o Espiritual, Techno Sutra, Medita√ß√£o">
    <meta name="author" content="Techno Sutra AR">
    <meta name="robots" content="index, follow">
    <meta name="language" content="Portuguese">
    <meta name="revisit-after" content="7 days">
    <meta name="theme-color" content="#7877c6">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://technosutra.com/map.html">
    <meta property="og:title" content="Mapa Interativo Techno Sutra AR - Navegue pelo Dharma Virtual">
    <meta property="og:description" content="Explore o mapa interativo dos 56 cap√≠tulos do Avatamsaka Sutra. Navegue pelo dharma virtual com visualiza√ß√µes em realidade aumentada.">
    <meta property="og:image" content="https://technosutra.com/imgs/icon.png">
    <meta property="og:site_name" content="Techno Sutra AR">
    <meta property="og:locale" content="pt_BR">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://technosutra.com/map.html">
    <meta property="twitter:title" content="Mapa Interativo Techno Sutra AR - Navegue pelo Dharma Virtual">
    <meta property="twitter:description" content="Explore o mapa interativo dos 56 cap√≠tulos do Avatamsaka Sutra com visualiza√ß√µes em realidade aumentada.">
    <meta property="twitter:image" content="https://technosutra.com/imgs/icon.png">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Techno Sutra AR">
    <link rel="apple-touch-icon" href="/imgs/icon.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/imgs/icon.png">
    <link rel="shortcut icon" href="/imgs/icon.png">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" as="style">
    <link rel="preload" href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js" as="script">
    
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <style>
        :root {
            --neon-blue: #00f4ff;
            --neon-purple: #bf40ff;
            --neon-pink: #ff0080;
            --neon-green: #00ff00;
            --neon-red: #ff0040;
            --neon-red-bright: #ff1155;
            --cyber-dark: #000000;
            --cyber-accent: #111111;
            --amoled-bg: rgba(0, 0, 0, 0.95);
            --amoled-border: rgba(0, 244, 255, 0.3);
            --glass-bg: var(--amoled-bg);
            --glass-border: var(--amoled-border);
        }

        * {
            box-sizing: border-box;
        }

        body, html { 
            margin: 0; 
            padding: 0; 
            width: 100%; 
            height: 100%; 
            font-family: 'Segoe UI', 'SF Pro Display', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            overflow: hidden;
            background: var(--cyber-dark);
        }

        #map { 
            width: 100%; 
            height: 100%; 
            position: relative;
        }

        /* Modern Collapsible Menu */
        .menu-container {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 2000;
            font-family: inherit;
        }

        .menu-toggle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--cyber-dark);
            border: 2px solid var(--neon-blue);
            backdrop-filter: blur(20px);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 20px rgba(0, 244, 255, 0.4), 0 8px 32px rgba(0, 0, 0, 0.8);
        }

        .menu-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 40px rgba(0, 244, 255, 0.3);
            border-color: var(--neon-blue);
        }

        .menu-icon {
            width: 24px;
            height: 24px;
            position: relative;
            transform: rotate(0deg);
            transition: 0.3s ease-in-out;
        }

        .menu-icon span {
            display: block;
            position: absolute;
            height: 3px;
            width: 100%;
            background: var(--neon-blue);
            border-radius: 9px;
            opacity: 1;
            left: 0;
            transform: rotate(0deg);
            transition: 0.25s ease-in-out;
            box-shadow: 0 0 10px var(--neon-blue);
        }

        .menu-icon span:nth-child(1) { top: 0px; }
        .menu-icon span:nth-child(2) { top: 8px; }
        .menu-icon span:nth-child(3) { top: 16px; }

        .menu-toggle.open .menu-icon span:nth-child(1) {
            top: 8px;
            transform: rotate(135deg);
        }

        .menu-toggle.open .menu-icon span:nth-child(2) {
            opacity: 0;
            left: -60px;
        }

        .menu-toggle.open .menu-icon span:nth-child(3) {
            top: 8px;
            transform: rotate(-135deg);
        }

        .menu-panel {
            position: absolute;
            top: 60px;
            left: 0;
            min-width: 280px;
            background: var(--cyber-dark);
            border: 2px solid var(--neon-blue);
            border-radius: 16px;
            backdrop-filter: blur(20px);
            padding: 20px;
            transform: translateY(-20px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 30px rgba(0, 244, 255, 0.5), 0 20px 60px rgba(0, 0, 0, 0.9);
        }

        .menu-panel.open {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .menu-section {
            margin-bottom: 20px;
        }

        .menu-section:last-child {
            margin-bottom: 0;
        }

        .menu-section h3 {
            color: var(--neon-blue);
            font-size: 14px;
            font-weight: 600;
            margin: 0 0 12px 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            margin: 6px 0;
            background: rgba(0, 244, 255, 0.05);
            border: 1px solid rgba(0, 244, 255, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-size: 14px;
            text-decoration: none;
        }

        .menu-item:hover {
            background: rgba(0, 244, 255, 0.1);
            border-color: var(--neon-blue);
            transform: translateX(4px);
            box-shadow: 0 4px 20px rgba(0, 244, 255, 0.2);
        }

        .menu-item .icon {
            margin-right: 12px;
            font-size: 16px;
        }

        .menu-item.active {
            background: rgba(0, 244, 255, 0.2);
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px rgba(0, 244, 255, 0.3);
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch::before {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: white;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .toggle-switch.active {
            background: var(--neon-blue);
            border-color: var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 244, 255, 0.5);
        }

        .toggle-switch.active::before {
            left: 28px;
        }

        .toggle-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            margin: 6px 0;
            background: rgba(0, 244, 255, 0.05);
            border: 1px solid rgba(0, 244, 255, 0.2);
            border-radius: 12px;
            color: white;
            font-size: 14px;
        }

        /* Enhanced Popups */
        .maplibregl-popup {
            max-width: 320px;
        }

        .maplibregl-popup-content {
            background: var(--cyber-dark) !important;
            border: 2px solid var(--neon-blue) !important;
            border-radius: 16px !important;
            backdrop-filter: blur(20px) !important;
            box-shadow: 0 0 20px rgba(0, 244, 255, 0.4), 0 20px 60px rgba(0, 0, 0, 0.8) !important;
        }

        /* Popup action buttons */
        .popup-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            justify-content: flex-end;
        }

        .popup-btn {
            border: 1px solid rgba(255,255,255,0.08);
            background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
            color: white;
            padding: 8px 10px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            font-size: 13px;
            backdrop-filter: blur(6px);
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }

        .popup-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(0,0,0,0.5); }

        .popup-btn.ar { background: linear-gradient(90deg, rgba(0,244,255,0.12), rgba(191,64,255,0.06)); border: 1px solid rgba(0,244,255,0.25); }
        .popup-btn.qr { background: linear-gradient(90deg, rgba(255,0,128,0.06), rgba(0,0,0,0.02)); border: 1px solid rgba(255,0,128,0.18); }

        .popup-content {
            padding: 16px;
            color: white;
        }

        .popup-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--neon-blue);
            font-size: 16px;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .popup-location {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .popup-coordinates {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
            font-family: monospace;
        }

        /* Neon Waypoint Markers */
        .waypoint-marker {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 5px currentColor;
            transition: all 0.3s ease;
            transform-origin: center;
        }

        .waypoint-marker.part1 {
            background: radial-gradient(circle, var(--neon-blue), transparent 70%);
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue), inset 0 0 15px rgba(0, 244, 255, 0.3);
        }

        .waypoint-marker.part2 {
            background: radial-gradient(circle, var(--neon-purple), transparent 70%);
            border: 2px solid var(--neon-purple);
            box-shadow: 0 0 15px var(--neon-purple), inset 0 0 15px rgba(191, 64, 255, 0.3);
        }

        .waypoint-marker:hover {
            transform: translate(-50%, -50%) scale(1.2);
            z-index: 1000;
        }

        /* Size variations for markers */
        .waypoint-marker.size-small {
            width: 16px;
            height: 16px;
            font-size: 8px;
        }

        .waypoint-marker.size-medium {
            width: 24px;
            height: 24px;
            font-size: 10px;
        }

        .waypoint-marker.size-large {
            width: 32px;
            height: 32px;
            font-size: 12px;
        }

        .waypoint-marker.size-extra-large {
            width: 40px;
            height: 40px;
            font-size: 14px;
        }

        .waypoint-marker::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: inherit;
            opacity: 0.6;
            animation: pulse-ring 2s infinite;
        }

        /* Enhanced User Marker */
        .user-marker {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--neon-pink), transparent 70%);
            border: 3px solid var(--neon-pink);
            box-shadow: 0 0 20px var(--neon-pink), inset 0 0 15px rgba(255, 0, 128, 0.3);
            position: relative;
        }

        .user-marker::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: var(--neon-pink);
            opacity: 0.4;
            animation: pulse-ring 1.5s infinite;
        }

        /* Hide default MapLibre icon for user marker */
        .maplibregl-marker .user-marker + svg {
            display: none !important;
        }
        
        /* More comprehensive hiding of default marker icons */
        .maplibregl-marker svg {
            display: none !important;
        }
        
        /* Ensure custom markers are visible */
        .maplibregl-marker .user-marker,
        .maplibregl-marker .waypoint-marker {
            display: flex !important;
            visibility: visible !important;
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(1);
                opacity: 0.6;
            }
            50% {
                transform: scale(1.5);
                opacity: 0.3;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        /* Theme specific styles */
        body.light-theme {
            --glass-bg: rgba(255, 255, 255, 0.9);
            --glass-border: rgba(0, 0, 0, 0.1);
        }

        body.light-theme .menu-item,
        body.light-theme .toggle-item,
        body.light-theme .popup-content {
            color: #333;
        }

        body.light-theme .popup-title {
            color: var(--neon-blue);
        }

        body.light-theme .popup-location {
            color: rgba(0, 0, 0, 0.7);
        }

        body.light-theme .popup-coordinates {
            color: rgba(0, 0, 0, 0.5);
        }

        /* Mobile Bottom Navigation */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 244, 255, 0.3);
            padding: 12px 0 calc(12px + env(safe-area-inset-bottom));
            z-index: 1000;
            display: none;
        }

        .mobile-nav-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            max-width: 400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            text-decoration: none;
            color: #9ca3af;
            transition: all 0.3s ease;
            padding: 8px 12px;
            border-radius: 12px;
            min-width: 60px;
        }

        .mobile-nav-item:hover,
        .mobile-nav-item.active {
            color: var(--neon-blue);
            background: rgba(0, 244, 255, 0.1);
            transform: translateY(-2px);
        }

        .mobile-nav-icon {
            font-size: 1.5rem;
            margin-bottom: 2px;
        }

        .mobile-nav-label {
            font-size: 0.7rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .mobile-nav-item.center {
            background: linear-gradient(135deg, rgba(0, 244, 255, 0.2) 0%, rgba(0, 244, 255, 0.1) 100%);
            border: 1px solid rgba(0, 244, 255, 0.3);
            color: #ffffff;
            transform: scale(1.1);
        }

        .mobile-nav-item.center:hover {
            background: linear-gradient(135deg, rgba(0, 244, 255, 0.3) 0%, rgba(0, 244, 255, 0.2) 100%);
            border-color: rgba(0, 244, 255, 0.5);
            transform: scale(1.15) translateY(-2px);
        }

        /* Desktop Back Button */
        .desktop-back-btn {
            position: fixed;
            top: 2%;
            left: 5%;
            z-index: 2000;
            background: var(--cyber-dark);
            border: 2px solid var(--neon-blue);
            color: var(--neon-blue);
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: 0.025em;
            box-shadow: 0 0 20px rgba(0, 244, 255, 0.4), 0 8px 32px rgba(0, 0, 0, 0.8);
            text-decoration: none;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .desktop-back-btn:hover {
            background: rgba(0, 244, 255, 0.1);
            border-color: var(--neon-blue);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 12px 40px rgba(0, 244, 255, 0.3);
            color: #ffffff;
        }

        /* Hide back button on mobile */
        @media (max-width: 768px) {
            .desktop-back-btn {
                display: none;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .mobile-nav {
                display: block;
            }
            
            body {
                padding-bottom: 80px;
            }
            
            .menu-panel {
                min-width: 260px;
                left: -10px;
            }
        }

        /* PWA safe area adjustments */
        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            .mobile-nav {
                padding-bottom: calc(12px + env(safe-area-inset-bottom));
            }
        }
    </style>
    <title>üåê Techno Sutra Trail Map - Cyberpunk Edition</title>
</head>
<body>
<div id="map"></div>

<!-- QR Modal (hidden by default) -->
<div id="qrModal" style="display:none; position:fixed; z-index:3000; inset:0; align-items:center; justify-content:center;">
    <div style="background:rgba(0,0,0,0.9); border:2px solid rgba(0,244,255,0.2); padding:18px; border-radius:14px; max-width:420px; width:90%; text-align:center;">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
            <div style="color:var(--neon-blue); font-weight:700;">QR Code</div>
            <button id="qrCloseBtn" style="background:none; border:none; color:#fff; font-size:20px; cursor:pointer;">√ó</button>
        </div>
        <div style="margin-top:12px;">
            <img id="qrImage" src="" alt="QR Code" style="max-width:100%; border-radius:8px; border:1px solid rgba(255,255,255,0.04);" />
        </div>
        <div style="margin-top:12px; display:flex; gap:8px; justify-content:center;">
            <a id="qrDownload" href="#" download style="text-decoration:none;"><button class="popup-btn qr">‚¨áÔ∏è Download</button></a>
            <button id="qrOpenNew" class="popup-btn" style="background:rgba(255,255,255,0.03);" onclick="openQRInNewTab()">üîé Open</button>
        </div>
    </div>
</div>

<!-- Desktop Back Button -->
<a href="index.html" class="desktop-back-btn">
    ‚Üê Voltar
</a>

<div id="logo-container">
    <img src="/imgs/icon.png" alt="TechnoSutra Logo" class="logo-image">
    <img src="lobo-guar%C3%A1.jpg" alt="Lobo Guar√°" class="logo-image">
</div>
    
    <!-- Modern Collapsible Menu -->
    <div class="menu-container">
        <div class="menu-toggle" onclick="toggleMenu()">
            <div class="menu-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="menu-panel" id="menuPanel">
            <div class="menu-section">
                <h3>üé® Map Style</h3>
                <div class="menu-item" onclick="setMapStyle('cyberpunk')" id="cyberpunk-style">
                    <span class="icon">üåÜ</span>
                    <span>Cyberpunk</span>
                </div>
                <div class="menu-item active" onclick="setMapStyle('satellite')" id="satellite-style">
                    <span class="icon">üõ∞Ô∏è</span>
                    <span>Sat√©lite</span>
                </div>
                <div class="menu-item" onclick="setMapStyle('simple')" id="simple-style">
                    <span class="icon">üó∫Ô∏è</span>
                    <span>Simples</span>
                </div>
            </div>
            
            
            <div class="menu-section">
                <h3>üß≠ The Trail</h3>
                <div class="menu-item" onclick="locateUser()">
                    <span class="icon">üìç</span>
                    <span>My Localization</span>
                </div>
                <div class="menu-item" onclick="zoomToTrail()">
                    <span class="icon">üéØ</span>
                    <span>Complete Hiking</span>
                </div>
            </div>
        </div>
    </div>
        
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <script>
        // Dados da trilha com informa√ß√µes do trail.json
        const trailData = 

{
  "1": { "lat": -21.868036707651, "lng": -46.67732383198648, "name": "Buda ≈öƒÅkyamuni", "location": "Jetavana, no parque de AnƒÅthapi·πá·∏çada em ≈örƒÅvastƒ´" },
  "2": { "lat": -21.86953296779599, "lng": -46.67805522448601, "name": "Samanta¬≠bhadra", "location": "Jetavana, no parque de AnƒÅthapi·πá·∏çada em ≈örƒÅvastƒ´" },
  "3": { "lat": -21.87091546996187, "lng": -46.67797426313243, "name": "Manjushri", "location": "DhanyƒÅkara e floresta sagrada de Vicitra sƒÅla dhvaja vy≈´ha" },
  "4": { "lat": -21.87221986659534, "lng": -46.67824132815174, "name": "Megha≈õrƒ´", "location": "Montanha Sugrƒ´va, na terra de RƒÅmƒÅvarƒÅnta" },
  "5": { "lat": -21.87309784586943, "lng": -46.67866035798463, "name": "SƒÅgara¬≠megha", "location": "Costa do oceano, distrito de SƒÅgaramukha" },
  "6": { "lat": -21.87393288759804, "lng": -46.67925395359822, "name": "Suprati·π£·π≠hita", "location": "SƒÅgaratƒ´ra, na regi√£o de La·πÖka" },
  "7": { "lat": -21.87514572152676, "lng": -46.67896578739468, "name": "Megha", "location": "Cidade de Vajrapura, na terra de Dravi·∏ça" },
  "8": { "lat": -21.87619736973498, "lng": -46.67855933883119, "name": "Muktaka", "location": "Cidade de VanavƒÅsƒ´" },
  "9": { "lat": -21.87646251203698, "lng": -46.67736879037174, "name": "SƒÅgara¬≠dhvaja", "location": "Milasphara·πáa, ponta do continente de Jambudvƒ´pa" },
  "10": { "lat": -21.87646009570215, "lng": -46.67623116961117, "name": "ƒÄ≈õƒÅ", "location": "Parque Samantavy≈´ha na cidade de SamudravetƒÅ·∏çƒ´" },
  "11": { "lat": -21.87726006988734, "lng": -46.6754990688399, "name": "Bhƒ´·π£mottara¬≠nirgho·π£a", "location": "Floresta na terra de NƒÅlayu" },
  "12": { "lat": -21.87881053413763, "lng": -46.67500319464728, "name": "Jayo·π£mƒÅyatana", "location": "Terra de ƒ™·π£ƒÅ·πáa, entre montanha de fogo e penhasco" },
  "13": { "lat": -21.88019054400148, "lng": -46.67496499173143, "name": "Maitraya·πáƒ´", "location": "Pal√°cio Vairocana-garbha na cidade de Si·πÉha-vij·πõmbhita" },
  "14": { "lat": -21.88187093491057, "lng": -46.67521163743071, "name": "Sudar≈õana", "location": "Densa floresta na terra de Trinayana" },
  "15": { "lat": -21.88360463284878, "lng": -46.67525319610547, "name": "Indriye≈õvara", "location": "Conflu√™ncia de rios na cidade de Sumukha" },
  "16": { "lat": -21.88554337763284, "lng": -46.67386659277159, "name": "Jayo·π£mƒÅyatana", "location": "Casa na cidade de Samudra-prati·π£·π≠hƒÅna" },
  "17": { "lat": -21.88804852246186, "lng": -46.67358940032627, "name": "VidvƒÅn", "location": "Encruzilhada no centro de MahƒÅsa·πÉbhava" },
  "18": { "lat": -21.89026427458782, "lng": -46.67236457977307, "name": "Sudar≈õana", "location": "Cidade de Si·πÉhapota, casa de dez andares" },
  "19": { "lat": -21.89257575982119, "lng": -46.67372402528618, "name": "Samanta¬≠netra", "location": "Loja de perfumes em Samantamukha, terra de Vetram≈´laka" },
  "20": { "lat": -21.89565884155847, "lng": -46.67312906215643, "name": "Anala", "location": "Cidade de TƒÅladhvaja, sala do trono" },
  "21": { "lat": -21.90046826241142, "lng": -46.67138193438598, "name": "MahƒÅprabha", "location": "Cidade de Suprabha, utopia de magnific√™ncia" },
  "22": { "lat": -21.90531978305068, "lng": -46.67251368039676, "name": "AcalƒÅ", "location": "Cidade de SthirƒÅ, casa dos pais" },
  "23": { "lat": -21.9089395994778, "lng": -46.67338258043213, "name": "Sarvagamin", "location": "Topo da colina Sulabha, perto de Tosala" },
  "24": { "lat": -21.91231515618248, "lng": -46.67015524085872, "name": "Utpalabh≈´ti", "location": "Terra de P·πõthurƒÅ·π£·π≠ra" },
  "25": { "lat": -21.91370861343965, "lng": -46.66815680928756, "name": "Vaira", "location": "Cidade costeira de K≈´·π≠ƒÅgƒÅra" },
  "26": { "lat": -21.91747796051475, "lng": -46.66700692393895, "name": "Jayottama", "location": "Floresta Vicitra Dhvaja, cidade de NandihƒÅra" },
  "27": { "lat": -21.92129874885887, "lng": -46.66574849523462, "name": "Si·πÉhavij·πõmbhitƒÅ", "location": "Parque S≈´rya Prabha, cidade de Kali·πÖgavana" },
  "28": { "lat": -21.92441500351332, "lng": -46.66505284033605, "name": "VasumitrƒÅ", "location": "Cidade de ≈öubhapara·πÉgama" },
  "29": { "lat": -21.92638215736361, "lng": -46.66537976269724, "name": "Ve·π£·π≠hila", "location": "Cidade de ≈öubhapƒÅra·πÉgama" },
  "30": { "lat": -21.92872573943014, "lng": -46.67003972230864, "name": "Avalokite≈õvara", "location": "Monte Potalaka, para√≠so terrestre" },
  "31": { "lat": -21.92801238471129, "lng": -46.67454405999145, "name": "AnanyagƒÅmin", "location": "Pico de montanha do sistema de mundos SahƒÅ" },
  "32": { "lat": -21.92645798923365, "lng": -46.67815322914891, "name": "MahƒÅdeva", "location": "Templo na encruzilhada da cidade de DvƒÅravatƒ´" },
  "33": { "lat": -21.92316358227298, "lng": -46.6791445469042, "name": "SthƒÅvarƒÅ", "location": "Bodhima·πá·∏ça na terra de Magadha" },
  "34": { "lat": -21.92362359048531, "lng": -46.6842726229277, "name": "VƒÅsantƒ´", "location": "C√©u acima da cidade de Kapilavastu" },
  "35": { "lat": -21.92525160262302, "lng": -46.6867179324565, "name": "Samanta¬≠gambhƒ´ra¬≠≈õrƒ´¬≠vimala¬≠prabhƒÅ", "location": "Bodhima·πá·∏ça, terra de Magadha, pr√≥ximo a VƒÅsantƒ´" },
  "36": { "lat": -21.9273497679517, "lng": -46.68749089829076, "name": "Pramudita¬≠nayana¬≠jagad¬≠virocanƒÅ", "location": "Bodhima·πá·∏ça, assembleia do Buda" },
  "37": { "lat": -21.9296471001546, "lng": -46.69039976309249, "name": "Samanta¬≠sattva¬≠trƒÅ·πáoja·∏•¬≠≈õrƒ´", "location": "No bodhima·πá·∏ça" },
  "38": { "lat": -21.92897397421807, "lng": -46.69217665332104, "name": "Pra≈õanta¬≠ruta¬≠sƒÅgara¬≠vatƒ´", "location": "No bodhima·πá·∏ça" },
  "39": { "lat": -21.93158183370527, "lng": -46.69375654414417, "name": "Sarva¬≠nagara¬≠rak·π£ƒÅ¬≠sa·πÉbhava¬≠teja·∏•¬≠≈õrƒ´", "location": "Trono de l√≥tus com s√©quito de deusas" },
  "40": { "lat": -21.93423405856974, "lng": -46.69338262520748, "name": "Sarva¬≠v·πõk·π£praphullana¬≠sukha¬≠sa·πÉvƒÅsƒÅ", "location": "K≈´·π≠ƒÅgƒÅra de √°rvores preciosas" },
  "41": { "lat": -21.93558462766117, "lng": -46.69382309551595, "name": "Sarva¬≠jagad¬≠rak·π£ƒÅ¬≠pra·πáidhƒÅna¬≠vƒ´rya¬≠prabhƒÅ", "location": "Bodhima·πá·∏ça, meio do s√©quito" },
  "42": { "lat": -21.93567267136837, "lng": -46.6939274554807, "name": "Sutejoma·πá·∏çala¬≠rati¬≠≈õrƒ´", "location": "Floresta de Lumbinƒ´, local de nascimento do Buda" },
  "43": { "lat": -21.93582378796983, "lng": -46.69400128111388, "name": "GopƒÅ", "location": "Sal√£o de assembleia dos bodhisattvas, Kapilavastu" },
  "44": { "lat": -21.945875, "lng": -46.72265833333334, "name": "MƒÅyƒÅdevƒ´", "location": "K≈´·π≠ƒÅgƒÅra miraculoso em grande l√≥tus de joias" },
  "45": { "lat": -21.94576185804032, "lng": -46.72279111267893, "name": "SurendrƒÅbhƒÅ", "location": "Para√≠so de TrƒÅyastri·πÉ≈õa (c√©u dos 33 deuses)" },
  "46": { "lat": -21.9458126872239, "lng": -46.72271692853997, "name": "Vi≈õvƒÅmitra", "location": "Cidade de Kapilavastu" },
  "47": { "lat": -21.94570944120324, "lng": -46.72285742172848, "name": "≈öilpƒÅbhij√±a", "location": "Ap√≥s falar com Vi≈õvƒÅmitra" },
  "48": { "lat": -21.94566634811362, "lng": -46.72291440447311, "name": "BhadrottamƒÅ", "location": "Cidade de Vartanaka, regi√£o de Kevalaka" },
  "49": { "lat": -21.94561390616393, "lng": -46.72297119284677, "name": "MuktƒÅsƒÅra", "location": "Cidade de Bharukaccha, regi√£o sul" },
  "50": { "lat": -21.9455701207428, "lng": -46.72301867573663, "name": "Sucandra", "location": "Floresta ao lado da cidade de Bharukaccha" },
  "51": { "lat": -21.94554168699781, "lng": -46.72306759875011, "name": "Ajitasena", "location": "Cidade de Roruka, regi√£o sul" },
  "52": { "lat": -21.94550541436743, "lng": -46.72312550616623, "name": "≈öivarƒÅgra", "location": "Vila chamada Dharma, regi√£o sul" },
  "53": { "lat": -21.94578734327873, "lng": -46.72274673868932, "name": "≈örƒ´sa·πÉbhava & ≈örƒ´mati", "location": "Cidade de SumanƒÅmukha, regi√£o sul" },
  "54": { "lat": -21.94585287592502, "lng": -46.72269285931593, "name": "Maitreya", "location": "Grande pavilh√£o Vairocana-vy≈´hƒÅla·πÉkƒÅra-garbha" },
  "55": { "lat": -21.9457395226932, "lng": -46.72281764935126, "name": "Manjushri", "location": "Cidade de SumanƒÅmukha, 110 yojanas de dist√¢ncia" },
  "56": { "lat": -21.9457395226932, "lng": -46.72281764935126, "name": "Samanta¬≠bhadra", "location": "Bodhima·πá·∏ça, diante do TathƒÅgata Vairocana" }
}


        // Converter dados da trilha para array
        const waypoints = Object.entries(trailData).map(([id, point]) => ({
            id: parseInt(id),
            ...point
        }));
        
        // Apply class for trail part markers
        waypoints.forEach((point) => {
            point.part = point.id <= 43 ? 'part1' : 'part2';
        });
        
        // Estilos de mapa com suporte completo
        const mapStyles = {
            cyberpunk: {
                name: 'Cyberpunk',
                style: {
                    "version": 8,
                    "sources": {
                        "terrain": {
                            "type": "raster",
                            "tiles": ["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],
                            "tileSize": 256,
                            "attribution": "¬© OpenStreetMap contributors"
                        }
                    },
                    "layers": [{
                        "id": "terrain",
                        "type": "raster",
                        "source": "terrain",
                        "paint": {
                            "raster-opacity": 0.8,
                            "raster-hue-rotate": 200,
                            "raster-saturation": -0.5,
                            "raster-brightness-min": 0,
                            "raster-brightness-max": 0.2,
                            "raster-contrast": 0.7
                        }
                    }],
                    "glyphs": "https://fonts.openmaptiles.org/{fontstack}/{range}.pbf"
                }
            },
            satellite: {
                name: 'Sat√©lite',
                style: {
                    "version": 8,
                    "sources": {
                        "satellite": {
                            "type": "raster",
                            "tiles": ["https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}"],
                            "tileSize": 256,
                            "attribution": "¬© Google Satellite"
                        }
                    },
                    "layers": [{
                        "id": "satellite",
                        "type": "raster",
                        "source": "satellite"
                    }]
                }
            },
            simple: {
                name: 'Simples',
                style: {
                    "version": 8,
                    "sources": {
                        "osm": {
                            "type": "raster",
                            "tiles": ["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],
                            "tileSize": 256,
                            "attribution": "¬© OpenStreetMap contributors"
                        }
                    },
                    "layers": [{
                        "id": "osm",
                        "type": "raster",
                        "source": "osm"
                    }]
                }
            },
        };
        
        let currentStyle = 'satellite';
        let currentMarkerSize = 'medium';
        let userMarker = null;
        let watchId = null;
        
        // Configura√ß√µes de alta precis√£o para geolocaliza√ß√£o
        const highAccuracyOptions = {
            enableHighAccuracy: true,  // Usar GPS quando dispon√≠vel
            timeout: 15000,           // 15 segundos para obter posi√ß√£o inicial
            maximumAge: 10000         // Aceitar posi√ß√£o de at√© 10 segundos atr√°s
        };
        
        const trackingOptions = {
            enableHighAccuracy: true,  // Manter GPS ativo para rastreamento
            timeout: 8000,            // 8 segundos para atualiza√ß√µes
            maximumAge: 15000         // Aceitar posi√ß√£o de at√© 15 segundos atr√°s
        };
        
        // Inicializar o mapa com vista sat√©lite
        const map = new maplibregl.Map({
            container: 'map',
            style: mapStyles.satellite.style,
            center: [-46.69, -21.91], // Centro aproximado da trilha
            zoom: 13,
            pitch: 0,
            bearing: 0
        });
        
        // Adicionar controles de navega√ß√£o
        map.addControl(new maplibregl.NavigationControl(), 'top-right');
        map.addControl(new maplibregl.ScaleControl(), 'bottom-right');
        
        // Fun√ß√µes de controle
        function toggleMapStyle() {
            const styleBtn = document.getElementById('styleBtn');
            const styles = Object.keys(mapStyles);
            const currentIndex = styles.indexOf(currentStyle);
            const nextIndex = (currentIndex + 1) % styles.length;
            currentStyle = styles[nextIndex];
            
            map.setStyle(mapStyles[currentStyle].style);
            
            const icons = { street: 'üó∫Ô∏è', satellite: 'üì°', hybrid: 'üåç' };
            styleBtn.innerHTML = `${icons[currentStyle]} ${mapStyles[currentStyle].name}`;
            
            // Re-adicionar as camadas ap√≥s mudan√ßa de estilo
            map.once('styledata', () => {
                addTrailLayers();
            });
        }
        
        function zoomToTrail() {
            const bounds = new maplibregl.LngLatBounds();
            waypoints.forEach(point => {
                bounds.extend([point.lng, point.lat]);
            });
            map.fitBounds(bounds, { padding: 50 });
        }
        
        function locateUser() {
            if (!navigator.geolocation) {
                alert('Geolocaliza√ß√£o n√£o √© suportada neste navegador.');
                return;
            }
            
            // Mostrar mensagem de carregamento
            const btn = document.querySelector('[onclick="locateUser()"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = 'üîÑ Localizando...';
            btn.disabled = true;
            
navigator.geolocation.getCurrentPosition(
                (position) => {
                    const userLocation = [position.coords.longitude, position.coords.latitude];
                    const accuracy = position.coords.accuracy;
                    
                    console.log(`Localiza√ß√£o obtida com precis√£o de ${accuracy} metros`);
                    
                    // Remover marcador anterior se existir
                    if (userMarker) {
                        userMarker.remove();
                    }
                    
                    // Criar elemento customizado para o marcador do usu√°rio
                    const userMarkerEl = document.createElement('div');
                    userMarkerEl.className = 'user-marker';
                    
                    userMarker = new maplibregl.Marker(userMarkerEl)
                        .setLngLat(userLocation)
                        .setPopup(new maplibregl.Popup().setHTML(
                            `<div class="popup-content">
                                <div class="popup-title">üìç Voc√™ est√° aqui</div>
                                <div style="font-size: 10px; color: #666; margin-top: 4px;">
                                    Precis√£o: ~${Math.round(accuracy)}m
                                </div>
                            </div>`
                        ))
                        .addTo(map);

                    map.flyTo({ center: userLocation, zoom: 17 });
                    
                    // Iniciar rastreamento cont√≠nuo
                    if (watchId) {
                        navigator.geolocation.clearWatch(watchId);
                    }
                    
                    watchId = navigator.geolocation.watchPosition(
                        (position) => {
                            const newLocation = [position.coords.longitude, position.coords.latitude];
                            if (userMarker) {
                                userMarker.setLngLat(newLocation);
                                
                                // Atualizar popup com nova precis√£o
                                const newAccuracy = position.coords.accuracy;
                                userMarker.setPopup(new maplibregl.Popup().setHTML(
                                    `<div class="popup-content">
                                        <div class="popup-title">üìç Voc√™ est√° aqui</div>
                                        <div style="font-size: 10px; color: #666; margin-top: 4px;">
                                            Precis√£o: ~${Math.round(newAccuracy)}m
                                        </div>
                                    </div>`
                                ));
                            }
                        },
                        (error) => {
                            console.warn('Erro no rastreamento:', error);
                            // Tentar novamente com configura√ß√µes menos restritivas se falhar
                            if (error.code === 3) { // TIMEOUT
                                navigator.geolocation.watchPosition(
                                    (position) => {
                                        const newLocation = [position.coords.longitude, position.coords.latitude];
                                        if (userMarker) {
                                            userMarker.setLngLat(newLocation);
                                        }
                                    },
                                    () => {}, // Silenciar erros subsequentes
                                    { enableHighAccuracy: false, maximumAge: 30000, timeout: 15000 }
                                );
                            }
                        },
                        trackingOptions
                    );
                    
                    // Restaurar bot√£o
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                },
                (error) => {
                    console.error('Erro de geolocaliza√ß√£o:', error);
                    let errorMessage = 'Erro ao obter localiza√ß√£o: ';
                    
                    switch(error.code) {
                        case 1: // PERMISSION_DENIED
                            errorMessage += 'Permiss√£o negada. Verifique as configura√ß√µes do navegador.';
                            break;
                        case 2: // POSITION_UNAVAILABLE
                            errorMessage += 'Posi√ß√£o indispon√≠vel. Tente novamente.';
                            break;
                        case 3: // TIMEOUT
                            errorMessage += 'Tempo esgotado. Tentando com menor precis√£o...';
                            // Tentar novamente com configura√ß√µes menos restritivas
                            navigator.geolocation.getCurrentPosition(
                                (position) => {
                                    const userLocation = [position.coords.longitude, position.coords.latitude];
                                    
                                    if (userMarker) {
                                        userMarker.remove();
                                    }
                                    
                                    const userMarkerEl = document.createElement('div');
                                    userMarkerEl.className = 'user-marker';
                                    
                                    userMarker = new maplibregl.Marker(userMarkerEl)
                                        .setLngLat(userLocation)
                                        .setPopup(new maplibregl.Popup().setHTML(
                                            '<div class="popup-content"><div class="popup-title">üìç Voc√™ est√° aqui (baixa precis√£o)</div></div>'
                                        ))
                                        .addTo(map);
                                    
                                    map.flyTo({ center: userLocation, zoom: 15 });
                                },
                                () => alert('N√£o foi poss√≠vel obter sua localiza√ß√£o.'),
                                { enableHighAccuracy: false, timeout: 15000, maximumAge: 300000 }
                            );
                            break;
                        default:
                            errorMessage += error.message;
                    }
                    
                    if (error.code !== 3) {
                        alert(errorMessage);
                    }
                    
                    // Restaurar bot√£o
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                },
                highAccuracyOptions
            );
        }
        
        function toggleInfo() {
            const info = document.getElementById('trailInfo');
            info.style.display = info.style.display === 'none' ? 'block' : 'none';
        }
        
        function addTrailLayers() {
            // Adicionar fonte da trilha Parte 1
            if (!map.getSource('route1')) {
                map.addSource('route1', {
                    'type': 'geojson',
                    'data': {
                        'type': 'Feature',
                        'geometry': {
                            'type': 'LineString',
                            'coordinates': waypoints.slice(0, 43).map(point => [point.lng, point.lat])
                        }
                    }
                });
            }
            
            if (!map.getLayer('route1')) {
                map.addLayer({
                    'id': 'route1',
                    'type': 'line',
                    'source': 'route1',
                    'layout': {
                        'line-join': 'round',
                        'line-cap': 'round'
                    },
                    'paint': {
                        'line-color': '#ff0040',
                        'line-width': 4,
                        'line-opacity': 0.7,
                        'line-blur': 3
                    }
                });
            }
            
            // Adicionar fonte da trilha Parte 2
            if (!map.getSource('route2')) {
                map.addSource('route2', {
                    'type': 'geojson',
                    'data': {
                        'type': 'Feature',
                        'geometry': {
                            'type': 'LineString',
                            'coordinates': waypoints.slice(43).map(point => [point.lng, point.lat])
                        }
                    }
                });
            }
            
            if (!map.getLayer('route2')) {
                map.addLayer({
                    'id': 'route2',
                    'type': 'line',
                    'source': 'route2',
                    'layout': {
                        'line-join': 'round',
                        'line-cap': 'round'
                    },
                    'paint': {
                        'line-color': '#ff1155',
                        'line-width': 4,
                        'line-opacity': 0.7,
                        'line-blur': 3
                    }
                });
            }
        }
        
        // Quando o mapa carregar
        map.on('load', () => {
            addTrailLayers();
            
            // Adicionar marcadores para cada waypoint
            addWaypoints();
            
            // Zoom inicial para mostrar toda a trilha
            zoomToTrail();
        });
        
        // Auto localizar usu√°rio ao carregar (desabilitado para evitar prompts desnecess√°rios)
        // Usu√°rio deve clicar em "My Localization" para ser localizado
        
        // Menu Functions
        function toggleMenu() {
            const menuToggle = document.querySelector('.menu-toggle');
            const menuPanel = document.getElementById('menuPanel');
            
            menuToggle.classList.toggle('open');
            menuPanel.classList.toggle('open');
        }
        
        function setMapStyle(style) {
            // Remove active from all
            document.querySelectorAll('.menu-item').forEach(item => {
                if (item.id && item.id.includes('-style')) {
                    item.classList.remove('active');
                }
            });
            
            // Add active to current
            document.getElementById(style + '-style').classList.add('active');
            
            currentStyle = style;
            map.setStyle(mapStyles[style].style);
            
            // Re-add layers after style change
            map.once('styledata', () => {
                addTrailLayers();
                addWaypoints();
            });
        }
        
        function setMarkerSize(size) {
            // Remove active class from previous size selection
            document.querySelectorAll('.menu-item').forEach(item => {
                if (item.id && item.id.includes('size-')) {
                    item.classList.remove('active');
                }
            });
            
            // Set active class to current size selection
            document.getElementById('size-' + size).classList.add('active');
            
            // Remove existing size classes
            document.querySelectorAll('.waypoint-marker').forEach(marker => {
                marker.classList.remove('size-small', 'size-medium', 'size-large', 'size-extra-large');
                marker.classList.add('size-' + size);
            });
            
            currentMarkerSize = size;
        }
        
        function toggleDarkMode() {
            const toggle = document.getElementById('darkModeToggle');
            const body = document.body;
            
            toggle.classList.toggle('active');
            body.classList.toggle('light-theme');
        }
        
        function toggleTrailPart(part) {
            const toggle = document.getElementById('trail' + part + 'Toggle');
            const layerId = 'route' + part;
            
            toggle.classList.toggle('active');
            
            if (map.getLayer(layerId)) {
                const visibility = map.getLayoutProperty(layerId, 'visibility');
                map.setLayoutProperty(layerId, 'visibility', 
                    visibility === 'visible' ? 'none' : 'visible');
            }
        }
        
        function toggleTrailInfo() {
            const info = document.getElementById('trailInfo');
            info.classList.toggle('visible');
        }
        
        function addWaypoints() {
            // Remove existing waypoint markers
            document.querySelectorAll('.maplibregl-marker').forEach(marker => {
                if (marker.querySelector('.waypoint-marker')) {
                    marker.remove();
                }
            });
            
            // Add waypoint markers
            waypoints.forEach((point) => {
                const waypointEl = document.createElement('div');
                waypointEl.className = 'waypoint-marker';
                waypointEl.innerHTML = point.id;
                waypointEl.classList.add(point.part);
                waypointEl.classList.add('size-' + currentMarkerSize);
                
                const popup = new maplibregl.Popup({ offset: 25 }).setHTML(
                    `<div class="popup-content">
                        <div class="popup-title">${point.id}. ${point.name}</div>
                        <div class="popup-location">${point.location}</div>
                        <div style="margin-top: 8px; font-size: 10px; color: #999;">
                            üìç ${point.lat.toFixed(6)}, ${point.lng.toFixed(6)}
                        </div>
                        <div class="popup-actions">
                            <button class="popup-btn ar" onclick="goToAR(${point.id})">üì≤ AR</button>
                            <button class="popup-btn qr" onclick="openQRModal(${point.id})">üî≥ QR Code</button>
                        </div>
                    </div>`
                );
                
                new maplibregl.Marker({ element: waypointEl, anchor: 'center' })
                    .setLngLat([point.lng, point.lat])
                    .setPopup(popup)
                    .addTo(map);
            });
        }
        
        // Cleanup ao sair da p√°gina
        window.addEventListener('beforeunload', () => {
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
            }
        });

        // ---------- AR / QR Helpers ----------
        function sanitizeModelNumber(input) {
            const n = parseInt(String(input).replace(/[^0-9]/g, ''), 10);
            if (!Number.isInteger(n) || n < 1 || n > 56) return null;
            return n;
        }

        function pad2(v) { return String(v).padStart(2, '0'); }

        function goToAR(modelNum) {
            const n = sanitizeModelNumber(modelNum);
            if (!n) { alert('N√∫mero de modelo inv√°lido'); return; }
            // preserve same behaviour as other pages: navigate to AR.html?model=N
            window.location.href = `AR.html?model=${encodeURIComponent(n)}`;
        }

        // QR modal logic
        const qrModal = document.getElementById('qrModal');
        const qrImage = document.getElementById('qrImage');
        const qrDownload = document.getElementById('qrDownload');
        const qrCloseBtn = document.getElementById('qrCloseBtn');
        let currentQrUrl = null;

        function openQRModal(modelNum) {
            const n = sanitizeModelNumber(modelNum);
            if (!n) { alert('N√∫mero de modelo inv√°lido'); return; }
            const codeName = `QR_Model_${pad2(n)}.png`;
            // path in repository
            const url = `/qr_codes/qr_codes/${codeName}`;
            currentQrUrl = url;
            qrImage.src = url;
            qrDownload.href = url;
            qrDownload.setAttribute('download', codeName);
            qrModal.style.display = 'flex';
        }

        function closeQRModal() {
            qrModal.style.display = 'none';
            qrImage.src = '';
            currentQrUrl = null;
        }

        function openQRInNewTab() {
            if (!currentQrUrl) return;
            window.open(currentQrUrl, '_blank', 'noopener');
        }

        qrCloseBtn?.addEventListener('click', closeQRModal);
        qrModal?.addEventListener('click', (e) => { if (e.target === qrModal) closeQRModal(); });
    </script>

    <!-- Mobile Navigation Bar -->
    <nav class="mobile-nav">
        <div class="mobile-nav-container">
            <a href="galeria.html" class="mobile-nav-item active">
                <div class="mobile-nav-icon">‚Åú</div>
                <div class="mobile-nav-label">Galeria</div>
            </a>
            <a href="index.html" class="mobile-nav-item active">
                <div class="mobile-nav-icon">üéµ</div>
                <div class="mobile-nav-label">Home</div>
            </a>
            <a href="map.html" class="mobile-nav-item center">
                <div class="mobile-nav-icon">‚Åú</div>
                <div class="mobile-nav-label">Mapa</div>
            </a>
        </div>
    </nav>
    
    <!-- Cache Manager -->
    <link rel="stylesheet" href="/css/cache-manager.css">
    <script src="/js/cache-manager.js"></script>
</body>
</html>
